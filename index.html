<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PyPanel VS Ultimate</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Inter:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-base: #1e1e1e;
            --bg-activity: #333333;
            --bg-sidebar: #252526;
            --bg-title: #3c3c3c;
            --bg-status: #007acc;
            --fg-text: #cccccc;
            --border: #454545;
            --accent: #007acc;
            --hover: #2a2d2e;
            --selection: #37373d;
        }
        * { box-sizing: border-box; }
        body { margin: 0; height: 100vh; background: var(--bg-base); color: var(--fg-text); font-family: 'Inter', sans-serif; overflow: hidden; display: flex; flex-direction: column; user-select: none; }

        /* Main Layout */
        #app-wrapper { display: flex; flex: 1; overflow: hidden; width: 100%; height: 100%; transform-origin: top left; }

        /* 1. Activity Bar (Leftmost) */
        #activity-bar {
            width: 48px; background: var(--bg-activity); display: flex; flex-direction: column; align-items: center; padding-top: 10px; flex-shrink: 0;
        }
        .activity-icon { font-size: 24px; color: #858585; margin-bottom: 20px; cursor: pointer; padding: 10px; border-left: 2px solid transparent; }
        .activity-icon.active { color: #fff; border-left-color: #fff; }
        .activity-icon:hover { color: #fff; }

        /* 2. Sidebar (Explorer) */
        #sidebar {
            width: 250px; background: var(--bg-sidebar); border-right: 1px solid var(--bg-base); display: flex; flex-direction: column;
            transition: width 0.1s; overflow: hidden; flex-shrink: 0;
        }
        #sidebar.collapsed { width: 0 !important; border: none; }
        
        .sidebar-title { padding: 10px 20px; font-size: 11px; font-weight: bold; color: #bbb; text-transform: uppercase; display: flex; justify-content: space-between; }
        .sidebar-actions span { cursor: pointer; margin-left: 8px; font-size: 14px; }
        .sidebar-actions span:hover { color: #fff; }
        #file-tree { flex: 1; overflow-y: auto; overflow-x: hidden; }

        /* Tree Items */
        .tree-node { display: flex; flex-direction: column; font-size: 13px; color: #ccc; cursor: pointer; }
        .tree-content { display: flex; align-items: center; padding: 3px 0; border: 1px solid transparent; }
        .tree-content:hover { background: var(--hover); }
        .tree-content.active { background: var(--selection); color: #fff; }
        .tree-content.drag-over { background: #094771; border: 1px dashed var(--accent); }
        
        .tree-arrow { width: 20px; text-align: center; font-size: 10px; color: #ccc; transform: rotate(0deg); transition: 0.1s; }
        .tree-arrow.open { transform: rotate(90deg); }
        .tree-icon { margin-right: 6px; font-size: 16px; }
        .tree-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; }
        .tree-menu { opacity: 0; padding: 0 8px; font-weight: bold; }
        .tree-content:hover .tree-menu { opacity: 1; }

        /* 3. Main Editor Area */
        #main-area { flex: 1; display: flex; flex-direction: column; min-width: 0; background: var(--bg-base); }

        /* Title/Tabs Bar */
        #editor-title-bar {
            height: 35px; background: var(--bg-sidebar); display: flex; overflow-x: auto; align-items: center; border-bottom: 1px solid var(--bg-base);
        }
        #editor-title-bar::-webkit-scrollbar { height: 2px; }
        .tab {
            height: 100%; display: flex; align-items: center; padding: 0 10px; font-size: 13px; color: #969696; background: #2d2d2d; 
            border-right: 1px solid #252526; cursor: pointer; min-width: 120px; max-width: 200px;
        }
        .tab.active { background: var(--bg-base); color: #fff; border-top: 2px solid var(--accent); }
        .tab-close { margin-left: auto; font-size: 14px; border-radius: 3px; padding: 0 4px; visibility: hidden; }
        .tab:hover .tab-close { visibility: visible; }
        .tab-close:hover { background: #444; color: #fff; }

        /* Editor Toolbar (Run buttons) */
        #editor-actions {
            height: 30px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px; background: var(--bg-base);
        }
        .action-btn { background: none; border: none; color: #ccc; cursor: pointer; padding: 4px; font-size: 16px; margin-left: 5px; border-radius: 3px; }
        .action-btn:hover { background: #333; color: #fff; }
        .action-btn.run { color: #85d185; }

        /* Editor & Split View */
        #center-split { flex: 1; display: flex; overflow: hidden; position: relative; }
        #editor-container { flex: 1; position: relative; }
        
        #right-preview-pane { width: 50%; border-left: 1px solid var(--border); display: none; background: #fff; flex-direction: column; }
        #right-preview-pane.show { display: flex; }
        .preview-header { background: #f0f0f0; color: #333; padding: 5px 10px; font-size: 12px; font-weight: bold; border-bottom: 1px solid #ccc; }

        /* Bottom Panel (Terminal) */
        #bottom-panel { height: 200px; border-top: 1px solid var(--border); display: flex; flex-direction: column; background: var(--bg-base); }
        .panel-tabs { display: flex; height: 30px; border-bottom: 1px solid var(--border); }
        .panel-tab { padding: 0 15px; font-size: 11px; text-transform: uppercase; color: #888; display: flex; align-items: center; cursor: pointer; }
        .panel-tab.active { color: #fff; border-bottom: 1px solid var(--accent); }
        .panel-content { flex: 1; display: none; overflow: hidden; position: relative; }
        .panel-content.show { display: flex; flex-direction: column; }

        #output { flex: 1; padding: 10px; font-family: 'JetBrains Mono', monospace; font-size: 13px; color: #d4d4d4; overflow: auto; user-select: text; white-space: pre-wrap; }
        .shell-line { display: flex; padding: 0 10px 5px 10px; }
        .shell-prompt { color: #2ea043; margin-right: 8px; }
        #shell-input { flex: 1; background: transparent; border: none; color: #fff; outline: none; font-family: inherit; font-size: inherit; }

        /* Status Bar */
        #status-bar {
            height: 22px; background: var(--bg-status); color: #fff; display: flex; align-items: center; padding: 0 10px; font-size: 11px; z-index: 999;
        }
        .sb-item { margin-right: 15px; display: flex; align-items: center; gap: 5px; cursor: pointer; }
        .sb-right { margin-left: auto; display: flex; gap: 15px; }

        /* Resizers */
        .resizer-h { height: 4px; cursor: ns-resize; z-index: 10; background: transparent; margin-top: -2px; }
        .resizer-h:hover { background: var(--accent); }
        .resizer-v { width: 4px; cursor: ew-resize; z-index: 10; background: transparent; margin-left: -2px; }
        .resizer-v:hover { background: var(--accent); }

        /* Loading & Popups */
        #loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-base); z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .spinner { width: 40px; height: 40px; border: 3px solid #333; border-top: 3px solid var(--accent); border-radius: 50%; animation: spin 1s infinite linear; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        #context-menu { position: absolute; background: #252526; border: 1px solid #454545; display: none; z-index: 5000; width: 200px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .ctx-item { padding: 8px 12px; font-size: 13px; color: #ccc; cursor: pointer; display: flex; justify-content: space-between; }
        .ctx-item:hover { background: #04395e; color: #fff; }
        .ctx-key { color: #888; font-size: 11px; }
        .ctx-sep { height: 1px; background: #454545; margin: 4px 0; }

        #toast { position: fixed; top: 40px; left: 50%; transform: translateX(-50%); background: #252526; color: #fff; padding: 8px 16px; border-radius: 4px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); border: 1px solid #454545; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 6000; }
        #toast.show { opacity: 1; top: 60px; }

        /* Mobile */
        @media (max-width: 768px) {
            #activity-bar { width: 0; overflow: hidden; }
            #sidebar { position: absolute; height: 100%; z-index: 100; transform: translateX(-100%); box-shadow: 2px 0 10px #000; }
            #sidebar.open { transform: translateX(0); }
            #right-preview-pane { display: none !important; }
        }
    </style>
</head>
<body>

<div id="loading-screen">
    <div class="spinner"></div>
    <div style="color:#888; margin-top:15px; font-size:12px;">VS Code Environment Loading...</div>
</div>

<div id="toast">Message</div>

<div id="app-wrapper">
    <!-- 1. Activity Bar -->
    <div id="activity-bar">
        <div class="activity-icon active" title="Explorer" onclick="toggleSidebar()">üìÇ</div>
        <div class="activity-icon" title="Search">üîç</div>
        <div class="activity-icon" title="Source Control">üåø</div>
        <div class="activity-icon" title="Extensions">üß©</div>
    </div>

    <!-- 2. Workspace -->
    <div style="display:flex; flex-direction:column; flex:1; overflow:hidden;">
        <div style="display:flex; flex:1; overflow:hidden;">
            <!-- Sidebar -->
            <div id="sidebar">
                <div class="sidebar-title">
                    <span>Explorer</span>
                    <div class="sidebar-actions">
                        <span onclick="createNewFile()" title="New File">üìÑ</span>
                        <span onclick="createNewFolder()" title="New Folder">üìÅ</span>
                        <span onclick="resetAll()" title="Reset">‚ö°</span>
                    </div>
                </div>
                <div id="file-tree"></div>
            </div>

            <!-- Main Editor -->
            <div id="main-area">
                <div id="editor-title-bar">
                    <div id="tabs" style="display:flex; height:100%;"></div>
                </div>
                
                <div id="editor-actions">
                    <button class="action-btn run" onclick="runProject()" title="Run Code (Ctrl+Enter)">‚ñ∂</button>
                    <button class="action-btn" onclick="toggleLayout()" title="Split Editor">‚ó´</button>
                    <button class="action-btn" onclick="openPopup()" title="Open Preview Window">‚ùê</button>
                </div>

                <div id="center-split">
                    <div id="editor-container"></div>
                    
                    <div class="resizer-v" id="resizer-v" style="display:none;"></div>
                    
                    <div id="right-preview-pane">
                        <div class="preview-header">Web Preview</div>
                        <iframe id="right-preview-frame"></iframe>
                    </div>
                </div>

                <div class="resizer-h" id="resizer-h"></div>

                <!-- Bottom Panel -->
                <div id="bottom-panel">
                    <div class="panel-tabs">
                        <div class="panel-tab active" id="tab-term" onclick="switchPanel('terminal')">TERMINAL</div>
                        <div class="panel-tab" id="tab-web" onclick="switchPanel('preview')">WEB PREVIEW</div>
                        <div class="panel-tab" style="margin-left:auto; cursor:pointer;" onclick="clearOutput()">üóëÔ∏è</div>
                    </div>
                    
                    <div id="terminal-area" class="panel-content show">
                        <div id="output">
                            <div style="color:#666;">PyPanel Shell [Version 2.5]</div>
                            <div style="color:#666; margin-bottom:10px;">Copyright (c) 2025 PyPanel Corp. All rights reserved.</div>
                            <div id="term-log"></div>
                        </div>
                        <div class="shell-line">
                            <span class="shell-prompt">user@pypanel:~$</span>
                            <input type="text" id="shell-input" autocomplete="off" spellcheck="false">
                        </div>
                    </div>

                    <div id="preview-area" class="panel-content">
                        <iframe id="bottom-preview-frame" style="border:none; width:100%; height:100%; background:#fff;"></iframe>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div id="status-bar">
            <div class="sb-item"><span style="font-size:12px">‚ö°</span> <span id="cpu-val">0%</span></div>
            <div class="sb-item"><span style="font-size:12px">üíæ</span> <span id="mem-val">--</span></div>
            <div class="sb-item" onclick="toggleSidebar()">master*</div>
            
            <div class="sb-right">
                <div class="sb-item" id="zoom-ctrl" title="Zoom">
                    <span onclick="changeZoom(-0.1)">-</span> <span id="zoom-val">100%</span> <span onclick="changeZoom(0.1)">+</span>
                </div>
                <div class="sb-item">Ln <span id="cursor-ln">1</span>, Col <span id="cursor-col">1</span></div>
                <div class="sb-item">UTF-8</div>
                <div class="sb-item" id="lang-mode">Python</div>
                <div class="sb-item">üîî</div>
            </div>
        </div>
    </div>
</div>

<div id="context-menu">
    <div class="ctx-item" onclick="ctxRun()"><span>Run File</span><span class="ctx-key">Ctrl+Enter</span></div>
    <div class="ctx-sep"></div>
    <div class="ctx-item" onclick="ctxRename()"><span>Rename</span><span class="ctx-key">F2</span></div>
    <div class="ctx-item" onclick="ctxMove()"><span>Move to...</span></div>
    <div class="ctx-sep"></div>
    <div class="ctx-item" onclick="ctxDelete()" style="color:#ce9178;"><span>Delete</span><span class="ctx-key">Del</span></div>
</div>

<div id="popup-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9000; justify-content:center; align-items:center;">
    <div style="width:90%; height:90%; background:#fff; display:flex; flex-direction:column; box-shadow:0 0 20px rgba(0,0,0,0.5);">
        <div style="background:#333; color:#fff; padding:5px 10px; display:flex; justify-content:space-between;">
            <span>Preview Window</span><span style="cursor:pointer;" onclick="document.getElementById('popup-overlay').style.display='none'">√ó</span>
        </div>
        <iframe id="popup-content" style="flex:1; border:none;"></iframe>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.js"></script>
<script src="main.js"></script>
</body>
</html>
